{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacoesView","Mensagem","MensagemView","NegociacaoService","getNegociacaoDao","DataInvalidaException","Negociacao","Bind","DataConverter","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","_init","then","dao","listaTodos","negociacoes","forEach","negociacao","adiciona","catch","erro","texto","event","preventDefault","_criaNegociacao","_limpaFormulario","console","log","stack","message","paraData","value","parseInt","parseFloat","focus","apaga","apagaTodos","esvazia","importaNegociacoes","obterNegociacoesDoPeriodo","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes } from '../domain/negociacao/Negociacoes'\r\nimport { NegociacoesView } from '../ui/views/NegociacoesView'\r\nimport { Mensagem } from '../ui/models/Mensagem'\r\nimport { MensagemView } from '../ui/views/MensagemView'\r\nimport { NegociacaoService } from '../domain/negociacao/NegociacaoService'\r\nimport { getNegociacaoDao } from '../util/DaoFactory'\r\nimport { DataInvalidaException } from '../ui/converters/DataInvalidaException'\r\nimport { Negociacao } from '../domain/negociacao/Negociacao'\r\nimport { Bind } from '../util/Bind'\r\nimport { DataConverter } from '../ui/converters/DateConverter'\r\n\r\nexport class NegociacaoController {\r\n    constructor() {\r\n        const $ = document.querySelector.bind(document)\r\n        this._inputData = $(\"#data\")\r\n        this._inputQuantidade = $(\"#quantidade\")\r\n        this._inputValor = $(\"#valor\")\r\n        this._negociacoes = new Bind(\r\n            new Negociacoes(),\r\n            new NegociacoesView('#negociacoes'),\r\n            'adiciona', 'esvazia'\r\n        )\r\n        this._mensagem = new Bind(\r\n            new Mensagem(),\r\n            new MensagemView('#mensagemView'),\r\n            'texto'\r\n        )\r\n        this._service = new NegociacaoService()\r\n        this._init()\r\n    }\r\n    \r\n    _init() {\r\n        getNegociacaoDao()\r\n            .then(dao => dao.listaTodos())\r\n            .then(negociacoes => negociacoes.forEach(\r\n                negociacao => this._negociacoes.adiciona(negociacao)\r\n            ))\r\n            .catch(erro => this._mensagem.texto = erro)\r\n    }\r\n\r\n    adiciona(event) {\r\n        try {\r\n            event.preventDefault()\r\n            const negociacao = this._criaNegociacao()\r\n            getNegociacaoDao()\r\n                .then(dao => dao.adiciona(negociacao))\r\n                .then(() => {\r\n                    this._negociacoes.adiciona(negociacao)\r\n                    this._mensagem.texto = 'Negociação adicionada com sucesso'\r\n                    this._limpaFormulario()\r\n                })\r\n        } catch (erro) {\r\n            console.log(erro)\r\n            console.log(erro.stack)\r\n            if (erro instanceof DataInvalidaException) {\r\n                this._mensagem.texto = erro.message\r\n            } else {\r\n                this._mensagem.texto = 'Um erro inesperado aconteceu. Entre em contato com o suporte.'\r\n            }\r\n        }\r\n    }\r\n\r\n    _criaNegociacao() {\r\n        return new Negociacao(\r\n            DataConverter.paraData(this._inputData.value),\r\n            parseInt(this._inputQuantidade.value),\r\n            parseFloat(this._inputValor.value),\r\n        )\r\n    }\r\n\r\n    _limpaFormulario() {\r\n        this._inputData.value = ''\r\n        this._inputQuantidade.value = 1\r\n        this._inputValor.value = 0.0\r\n        this._inputData.focus()\r\n    }\r\n\r\n    apaga() {\r\n        getNegociacaoDao()\r\n            .then(dao => dao.apagaTodos())\r\n            .then(() => {\r\n                this._negociacoes.esvazia()\r\n                this._mensagem.texto = 'Negociações apagadas com sucesso'\r\n            })\r\n            .catch(erro => this._mensagem.texto = erro)\r\n    }\r\n\r\n    importaNegociacoes() {  \r\n        this._service\r\n            .obterNegociacoesDoPeriodo()\r\n                .then(negociacoes => {\r\n                    negociacoes\r\n                        .filter(novaNegociacao => this._negociacoes.paraArray()\r\n                            .some(negociacaoExistente => novaNegociacao.equals(negociacaoExistente)))\r\n                        .forEach(negociacao => this._negociacoes.adiciona(negociacao))\r\n                    this._mensagem.texto = 'Negociações do período importadas com sucessoo'\r\n                })\r\n                .catch(erro => this._mensagem.texto = erro)\r\n    }\r\n}\r\n"]}